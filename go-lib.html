<!doctype html><meta charset="utf-8">
<script>
  // ⚠️ PON AQUÍ la URL FINAL de la biblioteca (la misma que usas en Apps Script: BIB_URL)
  // Por ejemplo: const LIB_URL = 'https://script.google.com/macros/s/XXXXXXXX/exec';
  const LIB_URL = 'PON_AQUI_TU_BIB_URL';

  const APPS_SCRIPT_ENTRADA = 'https://script.google.com/macros/s/AKfycby2m0GoCweLlCLbnQVPwFRC3wPOpK3Zd7Qj6dZ55_N2urmatJmTl_6yaXUgWkkPvcY/exec';

  function getCookie(name){
    return document.cookie.split(';').map(s=>s.trim())
      .find(s=>s.startsWith(name+'='))?.split('=').slice(1).join('=') || '';
  }
  function readLS(k){ try{ return localStorage.getItem(k) || ''; }catch(e){ return ''; } }

  (function(){
    const redirLS = readLS('tp_redirect');
    const redirCK = decodeURIComponent(getCookie('tp_redirect') || '');
    const tokenLS = readLS('tp_token_v1');
    const tokenCK = decodeURIComponent(getCookie('tp_token_v1') || '');

    // 1) Preferimos redir almacenada
    let redir = redirLS || redirCK;

    // 2) Si no hay redir, pero sí token → la reconstruimos
    if (!redir) {
      const tk = tokenLS || tokenCK;
      if (tk && LIB_URL && LIB_URL !== 'PON_AQUI_TU_BIB_URL') {
        redir = `${LIB_URL}?tk=${encodeURIComponent(tk)}`;
      }
    }

    if (redir) {
      location.replace(redir);     // sesión presente → entra directo
    } else {
      location.replace(APPS_SCRIPT_ENTRADA); // sin sesión → pedir email
    }
  })();
</script>
