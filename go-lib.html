<!doctype html>
<meta charset="utf-8">
<title>Entrando…</title>
<script>
function readCookie(name) {
  return document.cookie
    .split('; ')
    .find(v => v.startsWith(name + '='))?.split('=')[1] || '';
}
(function () {
  // 1) Intento con cookie (más fiable en iOS PWA)
  let tk    = decodeURIComponent(readCookie('tp_token_v1') || '');
  let redir = decodeURIComponent(readCookie('tp_redirect') || '');

  // 2) Si no hay en cookie, pruebo localStorage (por si el navegador lo conserva)
  if (!tk || !redir) {
    try {
      tk    = localStorage.getItem('tp_token_v1') || tk;
      redir = localStorage.getItem('tp_redirect') || redir;
    } catch (e) {}
  }

  // 3) Si tengo sesión => salto directo; si no => puerta de entrada (Apps Script)
  if (tk && redir) {
    location.replace(redir);
  } else {
    location.replace('https://script.google.com/macros/s/AKfycbzQmsWA0CdVjdKzXHTSJeNhWFfvou-ffyL_cWQ73piWaakxZ8fv7Z9KPXdvDNae9xEY2A/exec');
  }
})();
</script>
