<!doctype html>
<meta charset="utf-8">
<script>
(async function () {
  const p = new URLSearchParams(location.search);
  const tk = p.get('tk') || '';
  const redir = p.get('redir') || '/';

  // Guardar en CacheStorage
  try {
    const cache = await caches.open('tp-session');
    const response = new Response(JSON.stringify({ token: tk, redirect: redir }), {
      headers: { 'Content-Type': 'application/json' }
    });
    await cache.put('/session', response);
    console.log('✅ Sesión guardada en CacheStorage');
  } catch (e) {
    console.error('❌ Error guardando en CacheStorage:', e);
  }

  // Guardar también en localStorage y cookies como respaldo
  try {
    localStorage.setItem('tp_token_v1', tk);
    localStorage.setItem('tp_redirect', redir);
    document.cookie = 'tp_token_v1=' + encodeURIComponent(tk) + '; path=/; max-age=31536000; SameSite=None; Secure';
    document.cookie = 'tp_redirect=' + encodeURIComponent(redir) + '; path=/; max-age=31536000; SameSite=None; Secure';
  } catch(e) {}

  location.replace(redir);
})();
</script>
