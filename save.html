<!doctype html><meta charset="utf-8">
<script>
  // Lee ?tk= y ?redir=
  const qs = new URLSearchParams(location.search);
  const tk = qs.get('tk') || '';
  const rd = qs.get('redir') || '';

  // Guarda en localStorage (si está disponible)
  try {
    localStorage.setItem('tp_token_v1', tk);
    localStorage.setItem('tp_redirect', rd);
  } catch (_) {}

  // Guarda también en cookie (fallback iOS)
  const maxAge = 60*60*24*365; // 1 año
  const domain = location.hostname.endsWith('.coach-alexlopez.com') ? '.coach-alexlopez.com' : location.hostname;
  document.cookie = `tp_token_v1=${encodeURIComponent(tk)}; Path=/; Max-Age=${maxAge}; SameSite=Lax; Secure; Domain=${domain}`;
  document.cookie = `tp_redirect=${encodeURIComponent(rd)}; Path=/; Max-Age=${maxAge}; SameSite=Lax; Secure; Domain=${domain}`;

  // Salta a la biblioteca
  if (rd) location.replace(rd);
  else document.body.innerHTML = 'Guardado. Falta redir.';
</script>
