<!doctype html>
<meta charset="utf-8">
<title>Guardando…</title>
<script>
(function () {
  const qs = new URLSearchParams(location.search);
  const tk    = qs.get('tk')    || '';
  const redir = qs.get('redir') || '/';

  // Guardar en localStorage (por si iOS lo respeta)
  try {
    localStorage.setItem('tp_token_v1', tk);
    localStorage.setItem('tp_redirect', redir);
  } catch (e) {}

  // Guardar también en cookie (30 días) para cuando iOS “olvide” el localStorage
  try {
    const max = 60 * 60 * 24 * 30;
    document.cookie = `tp_token_v1=${encodeURIComponent(tk)}; Max-Age=${max}; Path=/; SameSite=Lax; Secure`;
    document.cookie = `tp_redirect=${encodeURIComponent(redir)}; Max-Age=${max}; Path=/; SameSite=Lax; Secure`;
  } catch (e) {}

  // Ir a la biblioteca
  location.replace(redir);
})();
</script>
